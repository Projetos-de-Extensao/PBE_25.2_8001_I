{% extends 'base.html' %}

{% block title %}Gerenciar Candidaturas - Professor{% endblock %}

{% block extra_css %}
<style>
	/* Professor-specific theme */
	:root {
		--prof-primary: #372e83;
		--prof-accent: #4d3fca;
		--prof-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		--prof-hover: rgba(55, 46, 131, 0.1);
		--prof-text: #64748b;
		--prof-bg: rgba(255, 255, 255, 0.9);
	}
	
	/* Modern HUD Navigation */
	.professor-nav-hud {
		background: linear-gradient(135deg, #f8f9ff 0%, #e8ecf7 100%);
		backdrop-filter: blur(10px);
		position: relative;
		z-index: 100;
	}
	
	.nav-hud-container {
		padding: 1rem 0;
	}
	
	.nav-tabs-custom {
		display: flex;
		gap: 0.5rem;
		padding: 0.5rem;
		justify-content: center;
		backdrop-filter: blur(20px);
		
	}
	
	.nav-tab {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    padding: 0.875rem 1.5rem;
    border-radius: 12px;
    text-decoration: none !important;
    color: var(--prof-text);
    font-weight: 500;
    font-size: 1rem;
    line-height: 1; /* garante alinhamento vertical da fonte */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 140px;
    cursor: pointer;
    user-select: none;
    border: none;
    background: transparent;
    text-align: center;
}
	
	.nav-tab:hover {
		color: rgb(84, 152, 255) !important;
		background: var(--prof-hover) !important;
		transform: translateY(-3px);
		text-decoration: none !important;
		
	}
	
	.nav-tab:focus {
		outline: none;
		box-shadow: 0 0 0 3px rgba(55, 46, 131, 0.2);
	}
	
	.nav-tab.active {
    color: rgb(2, 103, 255) !important;
    transform: translateY(-1px);
    font-weight: 600;
}
	
	.nav-tab.active:hover {
		background: var(--prof-gradient) !important;
		transform: translateY(-3px);
	}
	
	.nav-icon {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 20px;
		height: 20px;
		font-size: 1rem;
		text-align: center;
	}
	
	.nav-label {
		font-size: 0.9rem;
		font-weight: 600;
		white-space: nowrap;
		text-align: center;
		line-height: 1.2;
	}
	
	.nav-indicator {
		position: absolute;
		bottom: 0;
		left: 50%;
		transform: translateX(-50%);
		width: 0;
		height: 3px;
		background: var(--prof-gradient);
		border-radius: 2px;
		transition: width 0.3s ease;
	}
	
	.nav-tab.active .nav-indicator {
		width: 60%;
	}
	
	/* Responsive design */
	@media (max-width: 768px) {
		.nav-tabs-custom {
			flex-wrap: wrap;
			gap: 0.25rem;
		}
		
		.nav-tab {
			min-width: auto;
			flex: 1;
			padding: 0.75rem 1rem;
		}
		
		.nav-label {
			display: none;
		}
		
		.nav-icon {
			font-size: 1.1rem;
		}
	}
	
	.hero-section {
		background: linear-gradient(135deg, var(--prof-primary), #6a3fb3);
		color: #363636;
		padding: 2.5rem 0;
	}
	.candidatura-card {
		border-radius: 12px;
		box-shadow: 0 4px 12px rgba(75,46,131,0.08);
		transition: transform .15s ease;
	}
	.candidatura-card:hover { transform: translateY(-2px); }
	.status-badge {
		font-size: 0.8em;
		padding: 0.25rem 0.6rem;
		border-radius: 999px;
		font-weight: 600;
	}
	.status-submetida { background: #cce5ff; color: #0056b3; }
	.status-em_avaliacao { background: #fff3cd; color: #856404; }
	.status-aprovada { background: #d4edda; color: #155724; }
	.status-rejeitada { background: #f8d7da; color: #721c24; }
	.cr-badge {
		background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
		color: white;
		padding: 0.25rem 0.6rem;
		border-radius: 999px;
		font-weight: 600;
	}
	.candidato-avatar {
		width: 50px;
		height: 50px;
		background: linear-gradient(45deg, #667eea, #764ba2);
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		color: white;
		font-weight: bold;
		font-size: 1.2rem;
	}
</style>
{% endblock %}

{% block hero_title %}Gerenciar Candidaturas{% endblock %}
{% block hero_subtitle %}Avalie e gerencie as candidaturas recebidas{% endblock %}

{% block content %}
<!-- Professor Navigation HUD -->
<div class="professor-nav-hud mb-4">
	<div class="container">
		<div class="nav-hud-container">
			<div class="nav-tabs-custom">
				<a class="nav-tab" href="{% url 'prof_index' %}">
					<div class="nav-icon">
						<i class="fas fa-home"></i>
					</div>
					<span class="nav-label">Início</span>
					<div class="nav-indicator"></div>
				</a>
				<a class="nav-tab" href="{% url 'prof_gerenciar_vagas' %}">
					<div class="nav-icon">
						<i class="fas fa-briefcase"></i>
					</div>
					<span class="nav-label">Gerenciar Vagas</span>
					<div class="nav-indicator"></div>
				</a>
				<a class="nav-tab active" href="{% url 'prof_gerenciar_candidaturas' %}">
					<div class="nav-icon">
						<i class="fas fa-users"></i>
					</div>
					<span class="nav-label">Candidaturas</span>
					<div class="nav-indicator"></div>
				</a>
				<a class="nav-tab" href="{% url 'prof_relatorios' %}">
					<div class="nav-icon">
						<i class="fas fa-chart-bar"></i>
					</div>
					<span class="nav-label">Relatórios</span>
					<div class="nav-indicator"></div>
				</a>
			</div>
		</div>
	</div>
</div>

<div class="container mb-5">
	<div class="d-flex justify-content-between align-items-center mb-4">
		<div>
			<h3>Candidaturas Recebidas</h3>
			<p class="text-muted mb-0">{{ candidaturas.count|default:"0" }} candidatura{{ candidaturas.count|pluralize }} encontrada{{ candidaturas.count|pluralize }}</p>
		</div>
		<div>
			<button class="btn btn-outline-secondary me-2" data-bs-toggle="modal" data-bs-target="#filtroModal">
				<i class="bi bi-funnel"></i> Filtrar
			</button>
			<div class="btn-group">
				<button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
					<i class="bi bi-download"></i> Exportar
				</button>
				<ul class="dropdown-menu">
					<li><a class="dropdown-item" href="#"><i class="bi bi-file-excel"></i> Excel</a></li>
					<li><a class="dropdown-item" href="#"><i class="bi bi-filetype-csv"></i> CSV</a></li>
					<li><a class="dropdown-item" href="#"><i class="bi bi-filetype-pdf"></i> PDF</a></li>
				</ul>
			</div>
		</div>
	</div>

	<!-- Filtros rápidos -->
	<div class="row mb-4">
		<div class="col-12">
			<div class="btn-group me-3" role="group">
				<input type="radio" class="btn-check" name="status-filter" id="todas" checked>
				<label class="btn btn-outline-secondary" for="todas">Todas</label>
				
				<input type="radio" class="btn-check" name="status-filter" id="submetidas">
				<label class="btn btn-outline-primary" for="submetidas">Submetidas</label>
				
				<input type="radio" class="btn-check" name="status-filter" id="avaliacao">
				<label class="btn btn-outline-warning" for="avaliacao">Em Avaliação</label>
				
				<input type="radio" class="btn-check" name="status-filter" id="aprovadas">
				<label class="btn btn-outline-success" for="aprovadas">Aprovadas</label>
				
				<input type="radio" class="btn-check" name="status-filter" id="rejeitadas">
				<label class="btn btn-outline-danger" for="rejeitadas">Rejeitadas</label>
			</div>
			
			<div class="btn-group" role="group">
				<input type="radio" class="btn-check" name="vaga-filter" id="todas-vagas" checked>
				<label class="btn btn-outline-primary" for="todas-vagas">Todas as Vagas</label>
			</div>
		</div>
	</div>

	<!-- Lista de candidaturas -->
	{% if candidaturas %}
	<div class="row g-4">
		{% for candidatura in candidaturas %}
		<div class="col-12">
			<div class="card candidatura-card">
				<div class="card-body">
					<div class="row align-items-center">
						<div class="col-md-8">
							<div class="d-flex align-items-center mb-2">
								<div class="candidato-avatar me-3">
									{{ candidatura.candidato_nome|first|upper }}
								</div>
								<div>
									<h5 class="mb-0">{{ candidatura.candidato_nome }}</h5>
									<small class="text-muted">{{ candidatura.candidato_email }}</small>
								</div>
							</div>
							
							<div class="mb-2">
								<strong class="text-primary">{{ candidatura.vaga.titulo }}</strong>
								<small class="text-muted"> • {{ candidatura.vaga.disciplina.nome }}</small>
							</div>
							
							<div class="row mb-3">
								<div class="col-md-4">
									<small class="text-muted">Curso</small>
									<div class="fw-bold">{{ candidatura.candidato_curso|default:"Não informado" }}</div>
								</div>
								<div class="col-md-4">
									<small class="text-muted">Período</small>
									<div class="fw-bold">{{ candidatura.candidato_periodo|default:"Não informado" }}</div>
								</div>
								<div class="col-md-4">
									<small class="text-muted">CR</small>
									<div>
										{% if candidatura.candidato_cr %}
										<span class="cr-badge">{{ candidatura.candidato_cr }}</span>
										{% else %}
										<span class="text-muted">Não informado</span>
										{% endif %}
									</div>
								</div>
							</div>
							
							<div class="mb-2">
								<small class="text-muted">Submetida em: {{ candidatura.created_at|date:"d/m/Y H:i" }}</small>
							</div>
						</div>
						
						<div class="col-md-4 text-end">
							<div class="mb-3">
								<span class="status-badge status-{{ candidatura.status|lower }}">
									{{ candidatura.get_status_display }}
								</span>
							</div>
							
							<div class="btn-group-vertical w-100">
								<button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#detalhesModal-{{ candidatura.id }}">
									<i class="bi bi-eye"></i> Ver Detalhes
								</button>
								
								<div class="btn-group w-100">
									<button class="btn btn-success btn-sm" title="Aprovar">
										<i class="bi bi-check-circle"></i>
									</button>
									<button class="btn btn-warning btn-sm" title="Em Avaliação">
										<i class="bi bi-clock"></i>
									</button>
									<button class="btn btn-danger btn-sm" title="Rejeitar">
										<i class="bi bi-x-circle"></i>
									</button>
								</div>
								
								<div class="btn-group w-100">
									<button class="btn btn-outline-info btn-sm" title="Baixar Documentos">
										<i class="bi bi-download"></i> Docs
									</button>
									<button class="btn btn-outline-secondary btn-sm dropdown-toggle" data-bs-toggle="dropdown">
										<i class="bi bi-three-dots"></i>
									</button>
									<ul class="dropdown-menu">
										<li><a class="dropdown-item" href="#"><i class="bi bi-envelope"></i> Enviar Email</a></li>
										<li><a class="dropdown-item" href="#"><i class="bi bi-chat-dots"></i> Adicionar Nota</a></li>
										<li><hr class="dropdown-divider"></li>
										<li><a class="dropdown-item text-danger" href="#"><i class="bi bi-trash"></i> Excluir</a></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal de Detalhes da Candidatura -->
		<div class="modal fade" id="detalhesModal-{{ candidatura.id }}" tabindex="-1">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Detalhes da Candidatura</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-6">
								<h6>Informações do Candidato</h6>
								<p><strong>Nome:</strong> {{ candidatura.candidato_nome }}</p>
								<p><strong>Email:</strong> {{ candidatura.candidato_email }}</p>
								<p><strong>Curso:</strong> {{ candidatura.candidato_curso|default:"Não informado" }}</p>
								<p><strong>Período:</strong> {{ candidatura.candidato_periodo|default:"Não informado" }}</p>
								<p><strong>CR:</strong> {{ candidatura.candidato_cr|default:"Não informado" }}</p>
							</div>
							<div class="col-md-6">
								<h6>Informações da Vaga</h6>
								<p><strong>Título:</strong> {{ candidatura.vaga.titulo }}</p>
								<p><strong>Disciplina:</strong> {{ candidatura.vaga.disciplina.nome }}</p>
								<p><strong>Status:</strong> <span class="status-badge status-{{ candidatura.status|lower }}">{{ candidatura.get_status_display }}</span></p>
								<p><strong>Submetida em:</strong> {{ candidatura.created_at|date:"d/m/Y H:i" }}</p>
							</div>
						</div>
						
						{% if candidatura.carta_motivacao %}
						<div class="mt-3">
							<h6>Carta de Motivação</h6>
							<div class="bg-light p-3 rounded">{{ candidatura.carta_motivacao|linebreaks }}</div>
						</div>
						{% endif %}
						
						<div class="mt-3">
							<h6>Documentos</h6>
							<div class="row">
								{% if candidatura.historico_escolar %}
								<div class="col-md-6">
									<a href="{{ candidatura.historico_escolar.url }}" class="btn btn-outline-primary w-100 mb-2" target="_blank">
										<i class="bi bi-file-earmark-text"></i> Histórico Escolar
									</a>
								</div>
								{% endif %}
								{% if candidatura.curriculo %}
								<div class="col-md-6">
									<a href="{{ candidatura.curriculo.url }}" class="btn btn-outline-primary w-100 mb-2" target="_blank">
										<i class="bi bi-file-earmark-person"></i> Currículo
									</a>
								</div>
								{% endif %}
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
						<div class="btn-group">
							<button type="button" class="btn btn-success">Aprovar</button>
							<button type="button" class="btn btn-warning">Em Avaliação</button>
							<button type="button" class="btn btn-danger">Rejeitar</button>
						</div>
					</div>
				</div>
			</div>
		</div>
		{% endfor %}
	</div>
	{% else %}
	<div class="text-center py-5">
		<div class="mb-4">
			<i class="bi bi-inbox display-1 text-muted"></i>
		</div>
		<h4>Nenhuma candidatura encontrada</h4>
		<p class="text-muted mb-4">As candidaturas recebidas aparecerão aqui</p>
		<a href="{% url 'prof_index' %}" class="btn btn-primary">Voltar ao Painel</a>
	</div>
	{% endif %}
</div>

<!-- Modal de Filtros -->
<div class="modal fade" id="filtroModal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Filtrar Candidaturas</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<form>
					<div class="mb-3">
						<label class="form-label">Status</label>
						<select class="form-select">
							<option value="">Todos</option>
							<option value="submetida">Submetida</option>
							<option value="em_avaliacao">Em Avaliação</option>
							<option value="aprovada">Aprovada</option>
							<option value="rejeitada">Rejeitada</option>
						</select>
					</div>
					<div class="mb-3">
						<label class="form-label">Vaga</label>
						<select class="form-select">
							<option value="">Todas</option>
							{% comment %} {% for vaga in minhas_vagas %}
							<option value="{{ vaga.id }}">{{ vaga.titulo }}</option>
							{% endfor %} {% endcomment %}
						</select>
					</div>
					<div class="mb-3">
						<label class="form-label">CR Mínimo</label>
						<input type="number" class="form-control" step="0.1" min="0" max="10">
					</div>
					<div class="mb-3">
						<label class="form-label">Período de Submissão</label>
						<div class="row">
							<div class="col">
								<input type="date" class="form-control" placeholder="De">
							</div>
							<div class="col">
								<input type="date" class="form-control" placeholder="Até">
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
				<button type="button" class="btn btn-primary">Aplicar Filtros</button>
			</div>
		</div>
	</div>
</div>

{% endblock %}